<template id="app">
  <div class="col-md-9">
    <div class="row">
      <customer-selector :customers="$store.state.options.customers"></customer-selector>
      <hr>
      <div class="col-md-4">
        <div><bill-to-location-selector :locations="$store.state.options.customer_locations" after-selected-dispatch-event="billToLocationSelected" label="單據寄送至"></bill-to-location-selector></div>
        <div><ship-to-location-selector :locations="$store.state.options.customer_locations" after-selected-dispatch-event="shipToLocationSelected" label="貨品寄送至"></ship-to-location-selector></div>
        <div><ship-from-location-selector :locations="$store.state.options.stockable_locations" after-selected-dispatch-event="shipFromLocationSelected" label="出貨倉庫"></ship-from-location-selector></div>
      </div>
      <div class="col-md-4">
        <label>訂單日期</label><div><input type="date" @change="updateIssueDate"></div>
        <label>送貨日期</label><div><input type="date" @change="updateShipmentDate"></div>
        <label>Email</label><div><input type="text" @input="updateEmail"></div>
        <label>電話</label><div><input type="text" @input="updatePhone"></div>
      </div>
      <div class="col-md-4">
        <div><label>價別</label><select><option disabled selected value="">-- WIP --</option></select></div>
        <div>
          <label>總金額</label>
          <select @change="updateTaxTreatment">
            <option selected value="exclusive">稅外</option>
            <option value="inclusive">稅入</option>
          </select>
        </div>
      </div>

    </div>

    <div class="row"><hr></div>

    <div class="row">
      <line-item-selection-area
        :items="$store.state.options.items"
        :line_items="$store.state.sales_order_line_items">
      </line-item-selection-area>
    </div>
  </div>
</template>

<%= render 'components/sales_order/customer_selector' %>
<%= render 'components/sales_order/location_selector' %>
<%= render 'components/sales_order/line_item_selection_area' %>

<script type="text/javascript">
  var App = Vue.extend({
    template: '#app',
    components: {
      'customer-selector': CustomerSelector,
      'bill-to-location-selector': LocationSelector,
      'ship-to-location-selector': LocationSelector,
      'ship-from-location-selector': LocationSelector,
      'line-item-selection-area': LineItemSelectionArea,
    },
    props: {
      mode: String
    },
    data: function() {
      return {}
    },
    created: function() {
      this.$store.commit('setupMode', this.mode)
    },
    ready: function() {
      if (this.$store.state.mode === 'new' || this.$store.state.mode === 'edit') {
        this.$store.dispatch('getCustomerList')
        this.$store.dispatch('getPriceList')
        this.$store.dispatch('getStockableLocationList')
        this.$store.dispatch('getItemList')
        this.$store.dispatch('addNewLineItem')
      }
    },
    methods: {
      updateIssueDate: function(e) {
        this.$store.commit('updateIssueDate', e.target.value)
      },
      updateShipmentDate: function(e) {
        this.$store.commit('updateShipmentDate', e.target.value)
      },
      updateEmail: function(e) {
        this.$store.commit('updateEmail', e.target.value)
      },
      updatePhone: function(e) {
        this.$store.commit('updatePhone', e.target.value)
      },
      updateTaxTreatment: function(e) {
        this.$store.commit('updateTaxTreatment', e.target.value)
      },
    }
  })
</script>
